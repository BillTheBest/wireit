var WireIt={};WireIt.util={};WireIt.sn=function(D,C,A){if(!D){return }if(C){for(var B in C){var F=C[B];if(typeof (F)=="function"){continue}if(YAHOO.env.ua.ie&&B=="type"&&(D.tagName=="INPUT"||D.tagName=="SELECT")){continue}if(B=="className"){B="class";D.className=F}if(F!==D.getAttribute(B)){try{if(F===false){D.removeAttribute(B)}else{D.setAttribute(B,F)}}catch(E){console.log("WARNING: WireIt.sn failed for "+D.tagName+", attr "+B+", val "+F)}}}}if(A){for(var B in A){if(typeof (A[B])=="function"){continue}if(D.style[B]!=A[B]){D.style[B]=A[B]}}}};WireIt.cn=function(A,C,B,E){var D=document.createElement(A);this.sn(D,C,B);if(E){D.innerHTML=E}return D};WireIt.SetCanvasRegionIE=function(B,E,D,C,A){this.sn(B,null,{left:E+"px",top:D+"px",width:C+"px",height:A+"px"});B.getContext("2d").clearRect(0,0,C,A);return B};WireIt.SetCanvasRegionSafari=function(B,C,I,D,J){var G=B.className;if(!G){G=B.getAttribute("class")}var F=this.cn("canvas",{className:G,width:D,height:J},{left:C+"px",top:I+"px"});var H=YAHOO.util.Event.getListeners(B);for(var A in H){var E=H[A];YAHOO.util.Event.addListener(F,E.type,E.fn,E.obj,E.adjust)}YAHOO.util.Event.purgeElement(B);B.parentNode.replaceChild(F,B);return F};WireIt.SetCanvasRegionDefault=function(B,E,D,C,A){this.sn(B,{width:C,height:A},{left:E+"px",top:D+"px"});return B};WireIt.SetCanvasSize=function(D,E,A){if(YAHOO.env.ua.webkit||YAHOO.env.ua.opera){var B=D.className;if(!B){B=D.getAttribute("class")}var C=this.cn("canvas",{className:B,width:E,height:A});D.parentNode.replaceChild(C,D);return C}sn(D,{width:E,height:A},{width:E+"px",height:A+"px"});if(D.getContext){D.getContext("2d").clearRect(0,0,E,A)}return D};WireIt.SetCanvasRegion=YAHOO.env.ua.ie?WireIt.SetCanvasRegionIE:((YAHOO.env.ua.webkit||YAHOO.env.ua.opera)?WireIt.SetCanvasRegionSafari:WireIt.SetCanvasRegionDefault);if(!Array.prototype.indexOf){Array.prototype.indexOf=function(B){for(var A=0;A<this.length;A++){if(this[A]==B){return A}}return -1}}if(!Array.prototype.compact){Array.prototype.compact=function(){var B=[];for(var A=0;A<this.length;A++){if(this[A]){B.push(this[A])}}return B}}WireIt.Wire=function(D,C,B,A){this.parentEl=B;this.terminal1=D;this.terminal2=C;this.config=A||{};this.config.className=this.config.className||"WireIt-Wire";this.config.coeffMulDirection=YAHOO.lang.isUndefined(this.config.coeffMulDirection)?100:this.config.coeffMulDirection;this.config.cap=this.config.cap||"round";this.config.bordercap=this.config.bordercap||"round";this.config.width=this.config.width||3;this.config.borderwidth=this.config.borderwidth||1;this.config.color=this.config.color||"rgb(173, 216, 230)";this.config.bordercolor=this.config.bordercolor||"#0000ff";this.render();this.terminal1.addWire(this);this.terminal2.addWire(this)};WireIt.Wire.prototype.render=function(){this.el=WireIt.cn("canvas",{className:this.config.className});this.parentEl.appendChild(this.el);if(typeof (G_vmlCanvasManager)!="undefined"){this.el=G_vmlCanvasManager.initElement(this.el)}};WireIt.Wire.prototype.remove=function(){this.parentEl.removeChild(this.el);if(this.terminal1&&this.terminal1.removeWire){this.terminal1.removeWire(this)}if(this.terminal2&&this.terminal2.removeWire){this.terminal2.removeWire(this)}this.terminal1=null;this.terminal2=null};WireIt.Wire.prototype.redraw=function(){var O=this.terminal1.getXY();var M=this.terminal2.getXY();var F=this.config.coeffMulDirection;var B=Math.sqrt(Math.pow(O[0]-M[0],2)+Math.pow(O[1]-M[1],2));if(B<F){F=B/2}var C=[this.terminal1.config.direction[0]*F,this.terminal1.config.direction[1]*F];var A=[this.terminal2.config.direction[0]*F,this.terminal2.config.direction[1]*F];var L=[];L[0]=O;L[1]=[O[0]+C[0],O[1]+C[1]];L[2]=[M[0]+A[0],M[1]+A[1]];L[3]=M;var H=[O[0],O[1]];var K=[O[0],O[1]];for(var I=1;I<L.length;I++){var D=L[I];if(D[0]<H[0]){H[0]=D[0]}if(D[1]<H[1]){H[1]=D[1]}if(D[0]>K[0]){K[0]=D[0]}if(D[1]>K[1]){K[1]=D[1]}}var G=[4,4];H[0]=H[0]-G[0];H[1]=H[1]-G[1];K[0]=K[0]+G[0];K[1]=K[1]+G[1];var E=Math.abs(K[0]-H[0]);var N=Math.abs(K[1]-H[1]);this.el=WireIt.SetCanvasRegion(this.el,H[0],H[1],E,N);var J=this.el.getContext("2d");for(var I=0;I<L.length;I++){L[I][0]=L[I][0]-H[0];L[I][1]=L[I][1]-H[1]}J.lineCap=this.config.bordercap;J.strokeStyle=this.config.bordercolor;J.lineWidth=this.config.width+this.config.borderwidth*2;J.beginPath();J.moveTo(L[0][0],L[0][1]);J.bezierCurveTo(L[1][0],L[1][1],L[2][0],L[2][1],L[3][0],L[3][1]);J.stroke();J.lineCap=this.config.cap;J.strokeStyle=this.config.color;J.lineWidth=this.config.width;J.beginPath();J.moveTo(L[0][0],L[0][1]);J.bezierCurveTo(L[1][0],L[1][1],L[2][0],L[2][1],L[3][0],L[3][1]);J.stroke()};WireIt.Wire.prototype.getOtherTerminal=function(A){return(A==this.terminal1)?this.terminal2:this.terminal1};WireIt.DDTerminal=function(B,A){this.terminal=B;this.termConfig=A||{};WireIt.DDTerminal.superclass.constructor.call(this,this.terminal.el);YAHOO.util.Event.addListener(this.terminal.el,"mouseover",this.mouseOver,this,true);YAHOO.util.Event.addListener(this.terminal.el,"mouseout",this.mouseOut,this,true)};YAHOO.util.DDM.mode=YAHOO.util.DDM.INTERSECT;YAHOO.extend(WireIt.DDTerminal,YAHOO.util.DDProxy,{scissorOver:function(){clearTimeout(this.terminalTimeout)},scissorOut:function(){var A=this;this.terminalTimeout=setTimeout(function(){if(A.scissor){A.terminal.parentEl.parentNode.removeChild(A.scissor);A.scissor=undefined}},500)},scissorClick:function(){while(this.terminal.wires.length>0){this.terminal.wires[0].remove()}if(this.scissor){this.terminal.parentEl.parentNode.removeChild(this.scissor);this.scissor=undefined}},initCissor:function(){var B=this.terminal.getXY();var A=[B[0]+this.terminal.config.direction[0]*30-13,B[1]+this.terminal.config.direction[1]*30-10];this.scissor=WireIt.cn("div",{className:"WireIt-Wire-scissors"},{left:A[0]+"px",top:A[1]+"px"});this.terminal.parentEl.parentNode.appendChild(this.scissor);YAHOO.util.Event.addListener(this.scissor,"mouseover",this.scissorOver,this,true);YAHOO.util.Event.addListener(this.scissor,"mouseout",this.scissorOut,this,true);YAHOO.util.Event.addListener(this.scissor,"click",this.scissorClick,this,true)},mouseOver:function(){if(!this.scissor){if(this.terminal.wires.length>0){this.initCissor()}}},mouseOut:function(){var A=this;this.terminalTimeout=setTimeout(function(){if(A.scissor){A.terminal.parentEl.parentNode.removeChild(A.scissor);A.scissor=undefined}},300)},startDrag:function(){if(this.terminal.config.nMaxWires==1&&this.terminal.wires.length==1){this.terminal.wires[0].remove()}else{if(this.terminal.wires.length>=this.terminal.config.nMaxWires){return }}this.fakeTerminal={config:{direction:this.terminal.config.fakeDirection},pos:[200,200],offset:[this.terminal.parentEl.parentNode.offsetLeft-this.terminal.parentEl.parentNode.scrollLeft,this.terminal.parentEl.parentNode.offsetTop-this.terminal.parentEl.parentNode.scrollTop],addWire:function(){},removeWire:function(){},getXY:function(){return[this.pos[0]-this.offset[0],this.pos[1]-this.offset[1]]}};this.editingWire=new WireIt.Wire(this.terminal,this.fakeTerminal,this.terminal.parentEl.parentNode,this.terminal.config.editingWireConfig);YAHOO.util.Dom.addClass(this.editingWire.el,"WireIt-Wire-editing")},onDrag:function(A){this.fakeTerminal.pos=[A.clientX,A.clientY];this.editingWire.redraw()},endDrag:function(A){this.editingWire.remove();this.editingWire=null},onDragEnter:function(C,A){for(var B=0;B<A.length;B++){if(this.isValidWireTerminal(A[B])){A[B].terminal.setDropInvitation(true)}}},onDragOut:function(C,A){for(var B=0;B<A.length;B++){if(this.isValidWireTerminal(A[B])){A[B].terminal.setDropInvitation(false)}}},onDragDrop:function(F,C){this.onDragOut(F,C);var A=null;for(var D=0;D<C.length;D++){if(C[D].isWireItTerminal){A=C[D]}}if(A){if(this.isValidWireTerminal(A)){var E=false;for(var D=0;D<this.terminal.wires.length;D++){if(this.terminal.wires[D].terminal1==this.terminal){if(this.terminal.wires[D].terminal2==A.terminal){E=true;break}}else{if(this.terminal.wires[D].terminal2==this.terminal){if(this.terminal.wires[D].terminal1==A.terminal){E=true;break}}}}if(!E){if(A.terminal.config.nMaxWires==1){if(A.terminal.wires.length>0){A.terminal.wires[0].remove()}var B=new WireIt.Wire(this.terminal,A.terminal,this.terminal.parentEl.parentNode,this.terminal.config.wireConfig);B.redraw()}else{if(A.terminal.wires.length<A.terminal.config.nMaxWires){var B=new WireIt.Wire(this.terminal,A.terminal,this.terminal.parentEl.parentNode,this.terminal.config.wireConfig);B.redraw()}else{}}}else{}}}},isWireItTerminal:true,isValidWireTerminal:function(A){if(!A.isWireItTerminal){return false}if(this.termConfig.type){if(this.termConfig.allowedTypes){if(this.termConfig.allowedTypes.indexOf(A.termConfig.type)==-1){return false}}else{if(this.termConfig.type!=A.termConfig.type){return false}}}else{if(A.termConfig.type){if(A.termConfig.allowedTypes){if(A.termConfig.allowedTypes.indexOf(this.termConfig.type)==-1){return false}}else{if(this.termConfig.type!=A.termConfig.type){return false}}}}return true}});WireIt.Terminal=function(C,B,A){this.parentEl=C;this.container=A;this.wires=[];this.config=B||{};this.config.direction=this.config.direction||[0,1];this.config.fakeDirection=this.config.fakeDirection||[-this.config.direction[0],-this.config.direction[1]];this.config.className=this.config.className||"WireIt-Terminal";this.config.connectedClassName=this.config.connectedClassName||"WireIt-Terminal-connected";this.config.dropinviteClassName=this.config.dropinviteClassName||"WireIt-Terminal-dropinvite";this.config.editable=YAHOO.lang.isUndefined(this.config.editable)?true:this.config.editable;this.config.nMaxWires=this.config.nMaxWires||Infinity;this.eventAddWire=new YAHOO.util.CustomEvent("eventAddWire");this.eventRemoveWire=new YAHOO.util.CustomEvent("eventRemoveWire");this.el=null;this.render();if(this.config.editable){this.dd=new WireIt.DDTerminal(this,this.config.ddConfig)}};WireIt.Terminal.prototype.setDropInvitation=function(A){if(A){YAHOO.util.Dom.addClass(this.el,this.config.dropinviteClassName)}else{YAHOO.util.Dom.removeClass(this.el,this.config.dropinviteClassName)}};WireIt.Terminal.prototype.render=function(){this.el=WireIt.cn("div",{className:this.config.className});if(this.config.offsetPosition){this.el.style.left=this.config.offsetPosition[0]+"px";this.el.style.top=this.config.offsetPosition[1]+"px"}this.parentEl.appendChild(this.el)};WireIt.Terminal.prototype.addWire=function(A){this.wires.push(A);YAHOO.util.Dom.addClass(this.el,this.config.connectedClassName);this.eventAddWire.fire(A)};WireIt.Terminal.prototype.removeWire=function(D){var A=this.wires.indexOf(D);if(A!=-1){this.wires[A]=null;var C=[];for(var B=0;B<this.wires.length;B++){if(this.wires[B]){C.push(this.wires[B])}}this.wires=C;if(this.wires.length==0){YAHOO.util.Dom.removeClass(this.el,this.config.connectedClassName)}this.eventRemoveWire.fire(D)}};WireIt.Terminal.prototype.getXY=function(){var A=YAHOO.util.Dom.getXY(this.el);A[0]+=15-this.el.parentNode.parentNode.offsetLeft+this.el.parentNode.parentNode.scrollLeft;A[1]+=15-this.el.parentNode.parentNode.offsetTop+this.el.parentNode.parentNode.scrollTop;return A};WireIt.Terminal.prototype.remove=function(){while(this.wires.length>0){this.wires[0].remove()}this.parentEl.removeChild(this.el)};WireIt.Terminal.prototype.getConnectedTerminals=function(){var A=[];if(this.wires){for(var B=0;B<this.wires.length;B++){A.push(this.wires[B].getOtherTerminal())}}return A};WireIt.Terminal.prototype.redrawAllWires=function(){if(this.wires){for(var A=0;A<this.wires.length;A++){this.wires[A].redraw()}}};WireIt.util.TerminalInput=function(B,A){if(!A){var A={}}A.direction=[0,-1];A.fakeDirection=[0,1];A.ddConfig={type:"input",allowedTypes:["output"]};A.nMaxWires=1;WireIt.util.TerminalInput.superclass.constructor.call(this,B,A)};YAHOO.extend(WireIt.util.TerminalInput,WireIt.Terminal);WireIt.util.TerminalOutput=function(B,A){if(!A){var A={}}A.direction=[0,1];A.fakeDirection=[0,-1];A.ddConfig={type:"output",allowedTypes:["input"]};WireIt.util.TerminalOutput.superclass.constructor.call(this,B,A)};YAHOO.extend(WireIt.util.TerminalOutput,WireIt.Terminal);WireIt.util.DD=function(D,C,A,B){if(!D){throw new Error("WireIt.util.DD needs at least terminals and id")}this._WireItTerminals=D;WireIt.util.DD.superclass.constructor.call(this,C,A,B)};YAHOO.extend(WireIt.util.DD,YAHOO.util.DD,{onDrag:function(D){var A=YAHOO.lang.isArray(this._WireItTerminals)?this._WireItTerminals:(this._WireItTerminals.isWireItTerminal?[this._WireItTerminals]:[]);for(var C=0;C<A.length;C++){if(A[C].wires){for(var B=0;B<A[C].wires.length;B++){A[C].wires[B].redraw()}}}},setTerminals:function(A){this._WireItTerminals=A}});WireIt.util.DDResize=function(A,B){this.myConf=B||{};this.myConf.minWidth=this.myConf.minWidth||50;this.myConf.minHeight=this.myConf.minHeight||50;WireIt.util.DDResize.superclass.constructor.apply(this,[A.el,A.ddResizeHandle]);this.setHandleElId(A.ddResizeHandle);this.eventResize=new YAHOO.util.CustomEvent("eventResize")};YAHOO.extend(WireIt.util.DDResize,YAHOO.util.DragDrop,{onMouseDown:function(B){var A=this.getEl();this.startWidth=A.offsetWidth;this.startHeight=A.offsetHeight;this.startPos=[YAHOO.util.Event.getPageX(B),YAHOO.util.Event.getPageY(B)]},onDrag:function(F){var D=[YAHOO.util.Event.getPageX(F),YAHOO.util.Event.getPageY(F)];var A=D[0]-this.startPos[0];var G=D[1]-this.startPos[1];var E=Math.max(this.startWidth+A,this.myConf.minWidth);var C=Math.max(this.startHeight+G,this.myConf.minHeight);var B=this.getEl();B.style.width=E+"px";B.style.height=C+"px";this.eventResize.fire([E,C])}});WireIt.Container=function(A,B){this.config=A||{};this.config.terminals=this.config.terminals||[];this.config.draggable=(typeof this.config.draggable=="undefined")?true:this.config.draggable;this.config.position=this.config.position||[100,100];this.config.className=this.config.className||"WireIt-Container";this.config.ddHandle=(typeof this.config.ddHandle=="undefined")?true:this.config.ddHandle;this.config.ddHandleClassName=this.config.ddHandleClassName||"WireIt-Container-ddhandle";this.config.resizable=(typeof this.config.resizable=="undefined")?true:this.config.resizable;this.config.resizeHandleClassName=this.config.resizeHandleClassName||"WireIt-Container-resizehandle";this.config.width=this.config.width;this.config.height=this.config.height||100;this.config.close=(typeof this.config.close=="undefined")?true:this.config.close;this.config.closeButtonClassName=this.config.closeButtonClassName||"WireIt-Container-closebutton";this.layer=B;this.terminals=[];this.wires=[];this.el=null;this.bodyEl=null;this.eventAddWire=new YAHOO.util.CustomEvent("eventAddWire");this.eventRemoveWire=new YAHOO.util.CustomEvent("eventRemoveWire");this.render();this.initTerminals(this.config.terminals);if(this.config.draggable){if(this.config.resizable){this.ddResize=new WireIt.util.DDResize(this);this.ddResize.eventResize.subscribe(this.onResize,this)}this.dd=new WireIt.util.DD(this.terminals,this.el);if(this.config.ddHandle){this.dd.setHandleElId(this.ddHandle)}if(this.config.resizable){this.dd.addInvalidHandleId(this.ddResizeHandle);this.ddResize.addInvalidHandleId(this.ddHandle)}}};WireIt.Container.prototype.onResize=function(C,A){var B=A[0]};WireIt.Container.prototype.render=function(){this.el=WireIt.cn("div",{className:this.config.className},{width:this.config.width+"px",height:this.config.height+"px"});if(this.config.ddHandle){this.ddHandle=WireIt.cn("div",{className:this.config.ddHandleClassName});this.el.appendChild(this.ddHandle)}this.bodyEl=WireIt.cn("div",{className:"body"});this.el.appendChild(this.bodyEl);if(this.config.resizable){this.ddResizeHandle=WireIt.cn("div",{className:this.config.resizeHandleClassName});this.el.appendChild(this.ddResizeHandle)}if(this.config.close){this.closeButton=WireIt.cn("div",{className:this.config.closeButtonClassName});this.el.appendChild(this.closeButton);YAHOO.util.Event.addListener(this.closeButton,"click",this.onCloseButton,this,true)}this.layer.el.appendChild(this.el);this.el.style.left=this.config.position[0]+"px";this.el.style.top=this.config.position[1]+"px"};WireIt.Container.prototype.setBody=function(A){if(typeof A=="string"){this.bodyEl.innerHTML=A}else{this.bodyEl.innerHTML="";this.bodyEl.appendChild(A)}};WireIt.Container.prototype.onCloseButton=function(){this.layer.removeContainer(this)};WireIt.Container.prototype.remove=function(){this.removeAllTerminals();this.layer.el.removeChild(this.el)};WireIt.Container.prototype.initTerminals=function(B){for(var A=0;A<B.length;A++){this.addTerminal(B[A])}};WireIt.Container.prototype.addTerminal=function(C){var B=C.xtype||WireIt.Terminal;var A=new B(this.el,C,this);this.terminals.push(A);A.eventAddWire.subscribe(this.onAddWire,this,true);A.eventRemoveWire.subscribe(this.onRemoveWire,this,true);return A};WireIt.Container.prototype.onAddWire=function(B,A){var C=A[0];if(this.wires.indexOf(C)==-1){this.wires.push(C);this.eventAddWire.fire(C)}};WireIt.Container.prototype.onRemoveWire=function(C,B){var D=B[0];var A=this.wires.indexOf(D);if(A!=-1){this.eventRemoveWire.fire(D);this.wires[A]=null}this.wires=this.wires.compact()};WireIt.Container.prototype.removeAllTerminals=function(){for(var A=0;A<this.terminals.length;A++){this.terminals[A].remove()}this.terminals=[]};WireIt.Container.prototype.redrawAllWires=function(){for(var A=0;A<this.terminals.length;A++){this.terminals[A].redrawAllWires()}};WireIt.Layer=function(A){this.config=A||{};this.config.className=this.config.className||"WireIt-Layer";this.config.parentEl=this.config.parentEl||document.body;this.config.containers=this.config.containers||[];this.config.wires=this.config.wires||[];this.containers=[];this.wires=[];this.el=null;this.eventAddWire=new YAHOO.util.CustomEvent("eventAddWire");this.eventRemoveWire=new YAHOO.util.CustomEvent("eventRemoveWire");this.render();this.initContainers();this.initWires()};WireIt.Layer.prototype.render=function(){this.el=WireIt.cn("div",{className:this.config.className});this.config.parentEl.appendChild(this.el)};WireIt.Layer.prototype.initContainers=function(){for(var A=0;A<this.config.containers.length;A++){this.addContainer(this.config.containers[A])}};WireIt.Layer.prototype.initWires=function(){for(var A=0;A<this.config.wires.length;A++){this.addWire(this.config.wires[A])}};WireIt.Layer.prototype.addWire=function(A){var B=A.xtype||WireIt.Wire;var E=A.src;var G=A.tgt;var F=this.containers[E.moduleId].terminals[E.terminalId];var D=this.containers[G.moduleId].terminals[G.terminalId];var C=new B(F,D,this.el);C.redraw();return C};WireIt.Layer.prototype.addContainer=function(C){var B=C.xtype||WireIt.Container;var A=new B(C,this);this.containers.push(A);A.eventAddWire.subscribe(this.onAddWire,this,true);A.eventRemoveWire.subscribe(this.onRemoveWire,this,true);return A};WireIt.Layer.prototype.removeContainer=function(A){var B=this.containers.indexOf(A);if(B!=-1){A.remove();this.containers[B]=null;this.containers=this.containers.compact()}};WireIt.Layer.prototype.onAddWire=function(B,A){var C=A[0];if(this.wires.indexOf(C)==-1){this.wires.push(C);this.eventAddWire.fire(C)}};WireIt.Layer.prototype.onRemoveWire=function(C,B){var D=B[0];var A=this.wires.indexOf(D);if(A!=-1){this.eventRemoveWire.fire(D);this.wires[A]=null;this.wires=this.wires.compact()}};WireIt.Layer.prototype.removeAllContainers=function(){for(var A=this.containers.length-1;A>=0;A--){this.removeContainer(this.containers[A])}};if(YAHOO.util.Anim){WireIt.util.Anim=function(E,B,A,C,D){if(!E){throw new Error("WireIt.util.Anim needs at least terminals and id")}this._WireItTerminals=E;WireIt.util.Anim.superclass.constructor.call(this,B,A,C,D);this.onTween.subscribe(this.moveWireItWires,this,true)};YAHOO.extend(WireIt.util.Anim,YAHOO.util.Anim);WireIt.util.Anim.prototype.moveWireItWires=function(D){var A=YAHOO.lang.isArray(this._WireItTerminals)?this._WireItTerminals:(this._WireItTerminals.isWireItTerminal?[this._WireItTerminals]:[]);for(var C=0;C<A.length;C++){if(A[C].wires){for(var B=0;B<A[C].wires.length;B++){A[C].wires[B].redraw()}}}};WireIt.util.Anim.prototype.setTerminals=function(A){this._WireItTerminals=A}}