<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>WireIt Documentation - Layer.js</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="generator" content="JsDoc Toolkit 2.0.2" />
<link href="css/reset-fonts-grids.css" type="text/css" rel="stylesheet" media="all" /> 
<link href="css/dpSyntaxHighlighter.css" type="text/css" rel="stylesheet" media="all" />
<link href="css/style.css" type="text/css" rel="stylesheet" media="all" />
</head>
<body>
	
	<div id="doc3" class="yui-t2">					
		<div id="hd">
			
			
			<p class='layoutTitle'>WireIt Documentation <span><a href="../../">Back to homepage</a></span></p> 
			
			
			<h3>
				<a href="./index.html">WireIt Documentation</a> &gt; Layer.js
				<span class="subtitle">0.3.0</span>
			</h3>
		
		</div>
		<div id="bd">
			<div id="yui-main">
				<div class="yui-b">
<div class="summary description">
	<p>This is the source view for Layer.js</p>
</div>
										
<form>
	<textarea name="code" class="JScript">/**
 * @fileoverview A layer encapsulate a bunch of containers and wires.
 */
/**
 * @class WireIt.Layer
 * @constructor
 * @param {Object}   config   Configuration object (see the properties)
 */
WireIt.Layer = function(config) {
   
   /**
    * Configuration object of the layer
    * <ul>
    *   <li>className: CSS class name for the layer element (default 'WireIt-Layer')</li>
    *   <li>parentEl: DOM element that schould contain the layer (default document.body)</li>
    *   <li>containers: array of container configuration objects</li>  
    *   <li>wires: array of wire configuration objects</li>
    * </ul>
    */
   this.config = config || {};
   this.config.className = this.config.className || 'WireIt-Layer';
   this.config.parentEl = this.config.parentEl || document.body;
   this.config.containers = this.config.containers || [];
   this.config.wires = this.config.wires || [];
   this.config.layerMap = YAHOO.lang.isUndefined(this.config.layerMap) ? false : this.config.layerMap;
   
   /**
    * List of all the WireIt.Container (or subclass) instances in this layer
    */
   this.containers = [];
   
   /**
    * List of all the WireIt.Wire (or subclass) instances in this layer
    */
   this.wires = [];
   
   /**
    * Layer DOM element
    */
   this.el = null;
   
   
   /**
    * Event that is fired when a wire is added
    * You can register this event with myTerminal.eventAddWire.subscribe(function(e,params) { var wire=params[0];}, scope);
    */
   this.eventAddWire = new YAHOO.util.CustomEvent("eventAddWire");
   
   /**
    * Event that is fired when a wire is removed
    * You can register this event with myTerminal.eventRemoveWire.subscribe(function(e,params) { var wire=params[0];}, scope);
    */
   this.eventRemoveWire = new YAHOO.util.CustomEvent("eventRemoveWire");
   
   
   /**
    * Event that is fired when a container is added
    * You can register this event with myTerminal.eventAddContainer.subscribe(function(e,params) { var container=params[0];}, scope);
    */
   this.eventAddContainer = new YAHOO.util.CustomEvent("eventAddContainer");
   
   /**
    * Event that is fired when a container is removed
    * You can register this event with myTerminal.eventRemoveContainer.subscribe(function(e,params) { var container=params[0];}, scope);
    */
   this.eventRemoveContainer = new YAHOO.util.CustomEvent("eventRemoveContainer");
   
   /**
    * Event that is fired when a container has been moved
    * You can register this event with myTerminal.eventContainerDragged.subscribe(function(e,params) { var container=params[0];}, scope);
    */
   this.eventContainerDragged = new YAHOO.util.CustomEvent("eventContainerDragged");
   
   /**
    * Event that is fired when a container has been resized
    * You can register this event with myTerminal.eventContainerResized.subscribe(function(e,params) { var container=params[0];}, scope);
    */
   this.eventContainerResized = new YAHOO.util.CustomEvent("eventContainerResized");
   
   
   this.render();
   
   this.initContainers();
   
   this.initWires();
   
   if(this.config.layerMap) { 
      new WireIt.LayerMap({layer: this});
   }
   
};

WireIt.Layer.prototype = {

   /**
    * Create the dom of the layer and insert it into the parent element
    */
   render: function() {
   
      this.el = WireIt.cn('div', {className: this.config.className} );
   
      this.config.parentEl.appendChild(this.el);
   },


   /**
    * Create all the containers passed as config
    */
   initContainers: function() {
      for(var i = 0 ; i < this.config.containers.length ; i++) {
         this.addContainer(this.config.containers[i]);
      } 
   },

   /**
    * Create all the wires passed in the config
    */
   initWires: function() {
      for(var i = 0 ; i < this.config.wires.length ; i++) {
         this.addWire(this.config.wires[i]);
      }
   },

   /**
    * Instanciate a wire given its "xtype" (default to WireIt.Wire)
    * @param {Object} wireConfig  Wire configuration object (see WireIt.Wire class for details)
    * @return {WireIt.Wire} Wire instance build from the xtype
    */
   addWire: function(wireConfig) {
      var type = eval(wireConfig.xtype || "WireIt.Wire");
   
      var src = wireConfig.src;
      var tgt = wireConfig.tgt;
   
      var terminal1 = this.containers[src.moduleId].terminals[src.terminalId];
      var terminal2 = this.containers[tgt.moduleId].terminals[tgt.terminalId];
   
      var wire = new type( terminal1, terminal2, this.el);
      wire.redraw();
   
      return wire;
   },

   /**
    * Instanciate a container given its "xtype": WireIt.Container (default) or a subclass of it.
    * @param {Object} containerConfig  Container configuration object (see WireIt.Container class for details)
    * @return {WireIt.Container} Container instance build from the xtype
    */
   addContainer: function(containerConfig) {
   
      var type = eval(containerConfig.xtype || "WireIt.Container");
      var container = new type(containerConfig, this);
   
      this.containers.push( container );
   
      // Event listeners
      container.eventAddWire.subscribe(this.onAddWire, this, true);
      container.eventRemoveWire.subscribe(this.onRemoveWire, this, true);
   
      if(container.ddResize) {
         container.ddResize.on('endDragEvent', function() {
            this.eventContainerResized.fire(container);
         }, this, true);
      }
      if(container.dd) {
         container.dd.on('endDragEvent', function() {
            this.eventContainerDragged.fire(container);
         }, this, true);
      }
   
      this.eventAddContainer.fire(container);
   
      return container;
   },

   /**
    * Remove a container
    * @param {WireIt.Container} container Container instance to remove
    */
   removeContainer: function(container) {
      var index = WireIt.indexOf(container, this.containers);
      if( index != -1 ) {
         container.remove();
         this.containers[index] = null;
         this.containers = WireIt.compact(this.containers);
      
         this.eventRemoveContainer.fire(container);
      }
   },

   /**
    * Update the wire list when any of the containers fired the eventAddWire
    * @param {Event} event The eventAddWire event fired by the container
    * @param {Array} args This array contains a single element args[0] which is the added Wire instance
    */
   onAddWire: function(event, args) {
      var wire = args[0];
      // add the wire to the list if it isn't in
      if( WireIt.indexOf(wire, this.wires) == -1 ) {
         this.wires.push(wire);
         // Re-Fire an event at the layer level
         this.eventAddWire.fire(wire);
      }
   },

   /**
    * Update the wire list when a wire is removed
    * @param {Event} event The eventRemoveWire event fired by the container
    * @param {Array} args This array contains a single element args[0] which is the removed Wire instance
    */
   onRemoveWire: function(event, args) {
      var wire = args[0];
      var index = WireIt.indexOf(wire, this.wires);
      if( index != -1 ) {
         this.wires[index] = null;
         this.wires = WireIt.compact(this.wires);
         this.eventRemoveWire.fire(wire);
      }
   },

   /**
    * Remove all the containers in this layer (and the associated terminals and wires)
    */
   removeAllContainers: function() {
      while(this.containers.length > 0) {
         this.removeContainer(this.containers[0]);
      }
   },


   /**
    * Return an object that represent the state of the layer including the containers and the wires
    * @return {Obj} layer configuration
    */
   getWiring: function() {
   
      var i;
      var obj = {containers: [], wires: []};
   
      for( i = 0 ; i < this.containers.length ; i++) {
         obj.containers.push( this.containers[i].getConfig() );
      }
   
      for( i = 0 ; i < this.wires.length ; i++) {
         var wire = this.wires[i];
      
         var wireObj = { 
            src: {moduleId: WireIt.indexOf(wire.terminal1.container, this.containers), terminalId: WireIt.indexOf(wire.terminal1, wire.terminal1.container.terminals)}, 
            tgt: {moduleId: WireIt.indexOf(wire.terminal2.container, this.containers), terminalId: WireIt.indexOf(wire.terminal2, wire.terminal2.container.terminals)} 
         };
         obj.wires.push(wireObj);
      }
   
      return obj;
   },

   /**
    * Load a layer configuration object
    * @param {Object} wiring layer configuration
    */
   setWiring: function(wiring) {
      this.removeAllContainers();
   
      for(var i = 0 ; i < wiring.containers.length ; i++) {
         this.addContainer(wiring.containers[i]);
      }
   
      for(var i = 0 ; i < wiring.wires.length ; i++) {
          this.addWire(wiring.wires[i]);
       }
   },

   /**
    * Alias for removeAllContainers
    */
   clear: function() {
      this.removeAllContainers();
   }

};</textarea>
</form>
					
					
					</div>
			</div>
			
			<div class="yui-b">
				<div class="nav">
					
					<div class="module">
						<h4>Pages</h4>
						<ul class="content">
							
								
								<li>
								<a href="index.html">Index</a></li>
							
								
						</ul>
					</div>
					
					<div class="module">
						<h4>Classes <a href="treeview.html">(treeview)</a></h4>
						<ul class="content">
							
								
								<li>
									<a href="WireIt.html">WireIt</a></li>
							
								
								<li>
									<a href="WireIt.CanvasElement.html">WireIt.CanvasElement</a></li>
							
								
								<li>
									<a href="WireIt.Container.html">WireIt.Container</a></li>
							
								
								<li>
									<a href="WireIt.Layer.html">WireIt.Layer</a></li>
							
								
								<li>
									<a href="WireIt.LayerMap.html">WireIt.LayerMap</a></li>
							
								
								<li>
									<a href="WireIt.Scissors.html">WireIt.Scissors</a></li>
							
								
								<li>
									<a href="WireIt.Terminal.html">WireIt.Terminal</a></li>
							
								
								<li>
									<a href="WireIt.TerminalProxy.html">WireIt.TerminalProxy</a></li>
							
								
								<li>
									<a href="WireIt.util.html">WireIt.util</a></li>
							
								
								<li>
									<a href="WireIt.util.Anim.html">WireIt.util.Anim</a></li>
							
								
								<li>
									<a href="WireIt.util.DD.html">WireIt.util.DD</a></li>
							
								
								<li>
									<a href="WireIt.util.DDResize.html">WireIt.util.DDResize</a></li>
							
								
								<li>
									<a href="WireIt.util.TerminalInput.html">WireIt.util.TerminalInput</a></li>
							
								
								<li>
									<a href="WireIt.util.TerminalOutput.html">WireIt.util.TerminalOutput</a></li>
							
								
								<li>
									<a href="WireIt.Wire.html">WireIt.Wire</a></li>
							
								
						</ul>
					</div>
					
					<div class="module">
						<h4>Files</h4>
						<ul class="content">
							
								
								<li>
								<a href="Anim.js.html">Anim.js</a></li>
							
								
								<li>
								<a href="CanvasElement.js.html">CanvasElement.js</a></li>
							
								
								<li>
								<a href="Container.js.html">Container.js</a></li>
							
								
								<li>
								<a href="DD.js.html">DD.js</a></li>
							
								
								<li>
								<a href="DDResize.js.html">DDResize.js</a></li>
							
								<li class="selected">
								
								<a href="Layer.js.html">Layer.js</a></li>
							
								
								<li>
								<a href="LayerMap-beta.js.html">LayerMap-beta.js</a></li>
							
								
								<li>
								<a href="Terminal.js.html">Terminal.js</a></li>
							
								
								<li>
								<a href="Wire.js.html">Wire.js</a></li>
							
								
								<li>
								<a href="WireIt.js.html">WireIt.js</a></li>
							
						</ul>
					</div>
					
				</div>
			</div>
		</div>
		
		
		<div id="ft">
			<hr/>
			Copyright (c) 2007-2008 <a href='http://javascript.neyric.com' target='_new'>Eric Abouaf</a>. All rights reserved.<br />
			Generated by <a href="http://jsdoctoolkit.org/" target="_blank">JsDoc Toolkit</a> 2.0.2 on Sun, 12 Oct 2008 21:35:11 GMT using <a href="http://code.google.com/p/neyricjslibs-template/" target="_blank">neyricjslibs-template</a>.
		</div>
		
	</div>

<script src="js/dpSyntaxHighlighter.js" type="text/javascript"></script>
<script language="javascript"> 
dp.SyntaxHighlighter.HighlightAll('code');
</script>
</body>
</html>