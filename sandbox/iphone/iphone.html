<?xml version="1.0" encoding="UTF-8"?>
<html>
 <head>
  <title>WireIt Example, on the iPhone.</title>
  
<!-- YUI -->
<link rel="stylesheet" type="text/css" href="../lib/yui/reset-fonts/reset-fonts.css" />

<script type="text/javascript" src="../lib/yui/utilities/utilities.js"></script>

<!-- WireIt -->
<script type="text/javascript" src="../js/WireIt.js"></script>
<script type="text/javascript" src="../js/CanvasElement.js"></script>
<script type="text/javascript" src="../js/Wire.js"></script>
<script type="text/javascript" src="../js/Terminal.js"></script>
<link rel="stylesheet" type="text/css" href="../css/WireIt.css" />

<style>
div.blockBox {
	/* WireIt */
	position: absolute;
	z-index: 5;
	opacity: 0.8;
	filter: alpha(opacity = 80);
	
	/* Others */
	width: 50px;
	height: 380px;
	background-color: rgb(255,200,200);
}

div.WireIt-Terminal { margin: 20px 8px; }
#blockTop div.WireIt-Terminal, #blockBottom div.WireIt-Terminal { margin: 8px; float: left;}
</style>
<script>

window.onload = function() {
	
	var bl = YAHOO.util.Dom.get('blockLeft');
	var br = YAHOO.util.Dom.get('blockRight');
	var bt = YAHOO.util.Dom.get('blockTop');
	var bb = YAHOO.util.Dom.get('blockBottom');
	
		var t1 = new WireIt.Terminal(bl, {direction: [1,0] });
		new WireIt.Terminal(br, {direction: [-1,0] });
		var t2 = new WireIt.Terminal(bt, {direction: [0,1] });
		var t3 = new WireIt.Terminal(bb, {direction: [0,-1] });

		var w = new WireIt.Wire(t1,t2,document.body, {});
		w.redraw();
		
		/*
		 * iphone dd
		 */
		
		var currentId;
        var objects = {};
        var zIndex = 0;
      
        function init() {
            document.addEventListener("touchstart", startmove, false);
            document.addEventListener("touchmove", move, false);
            document.addEventListener("touchend", endmove, false);

            makeObjectMovable(t3.el);
        }

        function startmove(event) {
	try {
            var touch = event.touches[0];
            var id = touch.identifier;
            currentId = id;
            if (YAHOO.util.Dom.hasClass(touch.target,"movable")) {
                objects[id] = {
                    target: touch.target,
                    beginX: touch.clientX,
                    beginY: touch.clientY,
                    pozX: touch.target.pozXinit,
                    pozY: touch.target.pozYinit
                }
                touch.target.style.opacity = 0.5;
                touch.target.style.zIndex = ++zIndex;

	            event.preventDefault();
            }
	}catch(ex) { alert("start "+ex); }
        }

        function endmove(event) {
	try {
            var touch = event.touches[0];
            var id = currentId;
            if (objects[id] != null) {
                if (YAHOO.util.Dom.hasClass(objects[id].target,"movable")) {
                    objects[id].target.style.opacity = 1;
                }
                delete objects[id];
event.preventDefault();
            }
	}catch(ex) { alert("end "+ex); }
        }

        function move(event) {
	try {
            var touch = event.touches[0];
            var id = touch.identifier;
			alert(id);
			alert(objects[id]);
            if (YAHOO.util.Dom.hasClass(objects[id].target,"movable")) {
                objects[id].target.pozXinit = objects[id].pozX + touch.clientX - objects[id].beginX;
                objects[id].target.pozYinit = objects[id].pozY + touch.clientY - objects[id].beginY;
                objects[id].target.style['-webkit-transform'] = 'translate(' + objects[id].target.pozXinit + 'px,' + objects[id].target.pozYinit + 'px)';
event.preventDefault();
            }
  	}catch(ex) { alert("move "+ex); }
        }

        function makeObjectMovable(obj) {
			YAHOO.util.Dom.addClass("movable");
            obj.pozXinit = 0;
            obj.pozYinit = 0;
        }
		
		init();
};
</script>

 </head>
 <body>
	<p style="margin: 30px;"><a href="../index.html">&lt; Back</a></p>
	<p style="margin: 30px;">This example demonstrates how to create Terminals.</p>
	<p style="margin: 30px;">Try to create some wires by drag'n drop on the terminals. Click on the scissor to delete them.</p>
	
	<div id='blockLeft' class="blockBox" style="top: 150px; left: 200px;">
	</div>
	
	<div id='blockRight'  class="blockBox"  style="top: 150px; left: 400px;">
	</div>
	
	<div id='blockTop' class="blockBox" style="width: 380px; height: 50px; top: 150px; left: 600px;">
	</div>
	
	<div id='blockBottom'  class="blockBox"  style="width: 380px; height: 50px; top: 350px; left: 600px;">
	</div>

 </body>
</html>